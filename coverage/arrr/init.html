
<!doctype html>
<html lang="en">
  <head>
    <title>Code coverage report for init</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../style/reset.css">
    <link rel="stylesheet" href="../style/style.css">
  </head>
  <body>
   <div id="page-container">
      <header>
        <nav>
          
<ul class="inline-list">
    <li>
      <a href="../index.html">All Files</a> /
    </li>
    <li>
      <a href="./index.html">arrr</a> /
    </li>

  <li>init.lua</li>
</ul>

        </nav>
      </header>

      <main>
        <header class="hit-miss-statistics">
          
<ul class="inline-list">
  <li>
    <span class="strong">94.44%</span>
    <span class="quiet">Rate</span>
  </li>
  <li>
    <span class="strong">68</span>
    <span class="quiet">Hits</span>
  </li>
  <li>
    <span class="strong">4</span>
    <span class="quiet">Missed</span>
  </li>
</ul>

<div class="hit-percentage-status hit-percentage-status-high"></div>

        </header>
        <section id="content">
          
  <section class="file-coverage">

    <ul class="line-numbers undecorated">
        <li>1</li>
        <li>2</li>
        <li>3</li>
        <li>4</li>
        <li>5</li>
        <li>6</li>
        <li>7</li>
        <li>8</li>
        <li>9</li>
        <li>10</li>
        <li>11</li>
        <li>12</li>
        <li>13</li>
        <li>14</li>
        <li>15</li>
        <li>16</li>
        <li>17</li>
        <li>18</li>
        <li>19</li>
        <li>20</li>
        <li>21</li>
        <li>22</li>
        <li>23</li>
        <li>24</li>
        <li>25</li>
        <li>26</li>
        <li>27</li>
        <li>28</li>
        <li>29</li>
        <li>30</li>
        <li>31</li>
        <li>32</li>
        <li>33</li>
        <li>34</li>
        <li>35</li>
        <li>36</li>
        <li>37</li>
        <li>38</li>
        <li>39</li>
        <li>40</li>
        <li>41</li>
        <li>42</li>
        <li>43</li>
        <li>44</li>
        <li>45</li>
        <li>46</li>
        <li>47</li>
        <li>48</li>
        <li>49</li>
        <li>50</li>
        <li>51</li>
        <li>52</li>
        <li>53</li>
        <li>54</li>
        <li>55</li>
        <li>56</li>
        <li>57</li>
        <li>58</li>
        <li>59</li>
        <li>60</li>
        <li>61</li>
        <li>62</li>
        <li>63</li>
        <li>64</li>
        <li>65</li>
        <li>66</li>
        <li>67</li>
        <li>68</li>
        <li>69</li>
        <li>70</li>
        <li>71</li>
        <li>72</li>
        <li>73</li>
        <li>74</li>
        <li>75</li>
        <li>76</li>
        <li>77</li>
        <li>78</li>
        <li>79</li>
        <li>80</li>
        <li>81</li>
        <li>82</li>
        <li>83</li>
        <li>84</li>
        <li>85</li>
        <li>86</li>
        <li>87</li>
        <li>88</li>
        <li>89</li>
        <li>90</li>
        <li>91</li>
        <li>92</li>
        <li>93</li>
        <li>94</li>
        <li>95</li>
        <li>96</li>
        <li>97</li>
        <li>98</li>
        <li>99</li>
        <li>100</li>
        <li>101</li>
        <li>102</li>
        <li>103</li>
        <li>104</li>
        <li>105</li>
        <li>106</li>
        <li>107</li>
        <li>108</li>
        <li>109</li>
        <li>110</li>
        <li>111</li>
        <li>112</li>
        <li>113</li>
        <li>114</li>
        <li>115</li>
        <li>116</li>
        <li>117</li>
        <li>118</li>
        <li>119</li>
        <li>120</li>
        <li>121</li>
        <li>122</li>
        <li>123</li>
        <li>124</li>
        <li>125</li>
        <li>126</li>
        <li>127</li>
        <li>128</li>
        <li>129</li>
        <li>130</li>
        <li>131</li>
        <li>132</li>
        <li>133</li>
        <li>134</li>
        <li>135</li>
        <li>136</li>
        <li>137</li>
        <li>138</li>
        <li>139</li>
        <li>140</li>
        <li>141</li>
        <li>142</li>
        <li>143</li>
        <li>144</li>
        <li>145</li>
        <li>146</li>
        <li>147</li>
    </ul>

    <ul class="line-coverages undecorated">
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">24x</li>
        <li class="line-hit">168x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-hit">144x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">24x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">30x</li>
        <li class="line-hit">17x</li>
        <li class="line-hit">17x</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">16x</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">4x</li>
        <li class="line-hit">4x</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">3x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">15x</li>
        <li class="line-hit">12x</li>
        <li class="line-hit">12x</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">3x</li>
        <li class="line-hit">2x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">5x</li>
        <li class="line-hit">3x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">2x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">17x</li>
        <li class="line-miss">
</li>
        <li class="line-empty">
</li>
        <li class="line-miss">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">17x</li>
        <li class="line-miss">
</li>
        <li class="line-miss">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">17x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">13x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">9x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">30x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
        <li class="line-hit">20x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">20x</li>
        <li class="line-hit">20x</li>
        <li class="line-hit">52x</li>
        <li class="line-hit">34x</li>
        <li class="line-hit">34x</li>
        <li class="line-hit">34x</li>
        <li class="line-hit">5x</li>
        <li class="line-hit">3x</li>
        <li class="line-empty">
</li>
        <li class="line-hit">2x</li>
        <li class="line-hit">32x</li>
        <li class="line-hit">17x</li>
        <li class="line-hit">17x</li>
        <li class="line-hit">15x</li>
        <li class="line-hit">21x</li>
        <li class="line-hit">13x</li>
        <li class="line-hit">13x</li>
        <li class="line-hit">13x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">7x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">18x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">24x</li>
        <li class="line-hit">24x</li>
        <li class="line-empty">
</li>
        <li class="line-empty">
</li>
        <li class="line-hit">1x</li>
    </ul>

    <ul class="code undecorated">
        <li class="line-empty">--- A simple commandline argument parser.</li>
        <li class="line-empty">-- This module tries to provide a good approximation of how most programs</li>
        <li class="line-empty">-- interpret commandline flags while keeping the logic and rules simple.</li>
        <li class="line-empty">-- @module arrr</li>
        <li class="line-empty">-- @usage</li>
        <li class="line-empty">-- 	local arrr = require &#39;arrr&#39;</li>
        <li class="line-empty">-- 	parser = arrr { {&quot;Foos a bar&quot;, &quot;--foo&quot;, &quot;-f&quot;, &#39;bar&#39;} }</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Parses a list of argument descriptors.</li>
        <li class="line-empty">-- The format is: `{Description, Longhand, Shorthand, parameters, repeatable}`.</li>
        <li class="line-empty">-- All members except the longhand can be nil.</li>
        <li class="line-empty">local function parse(descriptors)</li>
        <li class="line-hit">	local register = {}</li>
        <li class="line-hit">	for _, descriptor in ipairs(descriptors) do</li>
        <li class="line-hit">		local current = {</li>
        <li class="line-hit">			name = descriptor[2]:gsub(&quot;^%-%-&quot;, &#39;&#39;);</li>
        <li class="line-hit">			description = descriptor[1];</li>
        <li class="line-hit">			params = descriptor[4];</li>
        <li class="line-hit">			repeatable = descriptor[5];</li>
        <li class="line-hit">			long = descriptor[2];</li>
        <li class="line-hit">			short = descriptor[3];</li>
        <li class="line-empty">		}</li>
        <li class="line-empty">
</li>
        <li class="line-hit">		if descriptor[2] then register[descriptor[2]] = current end</li>
        <li class="line-hit">		if descriptor[3] then register[descriptor[3]] = current end</li>
        <li class="line-hit">		table.insert(register, current)</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	return register</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Argument descriptor</li>
        <li class="line-empty">-- @table Argument</li>
        <li class="line-empty">-- @tfield string name The name of the parameter without dashes</li>
        <li class="line-empty">-- @tfield string long The long form of the parameter</li>
        <li class="line-empty">-- @tfield string short The short form of the parameter if present</li>
        <li class="line-empty">-- @tfield string description</li>
        <li class="line-empty">-- @field params The parameter(s) of the argument</li>
        <li class="line-empty">-- @tfield boolean repeatable Whether the argument should be collected into a table</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Handles a command</li>
        <li class="line-empty">-- @treturn Number the position of the first unhandled element in the list</li>
        <li class="line-empty">local function handle_command(data, token, list, start, descriptor, unknown_callback)</li>
        <li class="line-empty">	local result</li>
        <li class="line-hit">	if descriptor then</li>
        <li class="line-hit">		local params = descriptor.params</li>
        <li class="line-hit">		if type(params) == &quot;nil&quot; then</li>
        <li class="line-hit">			result = true</li>
        <li class="line-hit">		elseif params == &#39;*&#39; then</li>
        <li class="line-hit">			result = {}</li>
        <li class="line-hit">			for i=1,math.huge do</li>
        <li class="line-hit">				if not list[start]:find(&quot;^-&quot;) then</li>
        <li class="line-hit">					result[i] = list[start]</li>
        <li class="line-hit">					start = start+1</li>
        <li class="line-empty">				else</li>
        <li class="line-empty">					break</li>
        <li class="line-empty">				end</li>
        <li class="line-empty">			end</li>
        <li class="line-hit">		elseif type(params) == &quot;string&quot; or type(params) == true then</li>
        <li class="line-hit">			result = list[start]</li>
        <li class="line-hit">			start = start + 1</li>
        <li class="line-hit">		elseif type(params) == &quot;number&quot; then</li>
        <li class="line-hit">			result = {}</li>
        <li class="line-hit">			for i=1,params do</li>
        <li class="line-hit">				result[i] = list[start+i-1]</li>
        <li class="line-empty">			end</li>
        <li class="line-hit">			start = start+params</li>
        <li class="line-hit">		elseif type(params) == &quot;table&quot; then</li>
        <li class="line-hit">			result = {}</li>
        <li class="line-hit">			for i=1,#params do</li>
        <li class="line-hit">				result[params[i]] = list[start+i-1]</li>
        <li class="line-empty">			end</li>
        <li class="line-hit">			start = start+#params</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">		if descriptor.filter then</li>
        <li class="line-miss">			result = descriptor.filter(result)</li>
        <li class="line-empty">		else</li>
        <li class="line-miss">			result = result</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">		if descriptor.repeatable then</li>
        <li class="line-miss">			data[descriptor.name] = data[descriptor.name] or {}</li>
        <li class="line-miss">			table.insert(data[descriptor.name], result)</li>
        <li class="line-empty">		else</li>
        <li class="line-hit">			data[descriptor.name] = result</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">	else</li>
        <li class="line-empty">		-- Run callback if there is one</li>
        <li class="line-hit">		if not (unknown_callback and unknown_callback(token, data)) then</li>
        <li class="line-empty">			-- Insert as a positional argument so it can maybe be parsed later on</li>
        <li class="line-hit">			table.insert(data, token)</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	return start</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">local __parser = {__index = {}}</li>
        <li class="line-empty">
</li>
        <li class="line-hit">function __parser:__call(...)</li>
        <li class="line-hit">	return self:evaluate(...)</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Evaluates a chain of arguments.</li>
        <li class="line-empty">-- Known arguments (and their parameters) will be read into string keys.</li>
        <li class="line-empty">-- Extra arguments will be read into ascending integer keys.</li>
        <li class="line-empty">-- A single `--` causes the parser to abort and read all remaining elements into integer keys.</li>
        <li class="line-hit">function __parser.__index:evaluate(list)</li>
        <li class="line-hit">	local data = {}</li>
        <li class="line-hit">	local index = 1</li>
        <li class="line-hit">	while index &lt;= #list do</li>
        <li class="line-hit">		local current = list[index]</li>
        <li class="line-hit">		index = index + 1</li>
        <li class="line-hit">		if current == &#39;--&#39; then</li>
        <li class="line-hit">			for i = index, #list do</li>
        <li class="line-hit">				table.insert(data, list[i])</li>
        <li class="line-empty">			end</li>
        <li class="line-hit">			return data</li>
        <li class="line-hit">		elseif current:find &#39;^%-%-%a+$&#39; then</li>
        <li class="line-hit">			local descriptor = self[current]</li>
        <li class="line-hit">			index = handle_command(data, current, list, index, descriptor, self.unknown)</li>
        <li class="line-hit">		elseif current:find &#39;^%-%a+$&#39; then</li>
        <li class="line-hit">			for new in current:sub(2):gmatch(&quot;.&quot;) do</li>
        <li class="line-hit">				new = &#39;-&#39;..new</li>
        <li class="line-hit">				local descriptor = self[new]</li>
        <li class="line-hit">				index = handle_command(data, new, list, index, descriptor, self.unknown)</li>
        <li class="line-empty">			end</li>
        <li class="line-empty">		else</li>
        <li class="line-hit">			table.insert(data, current)</li>
        <li class="line-empty">		end</li>
        <li class="line-empty">	end</li>
        <li class="line-hit">	return data</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-empty">--- Returns a new commandline parser built from a param list.</li>
        <li class="line-empty">-- @usage</li>
        <li class="line-empty">-- 	local parser = arrr {</li>
        <li class="line-empty">-- 		{ &quot;Foos a bar&quot;, &quot;--foo&quot;, &quot;-f&quot;, {&#39;bar&#39;} };</li>
        <li class="line-empty">-- 		{ &quot;Foos a bar&quot;, &quot;--bar&quot;, &quot;-b&quot;, {&#39;bar&#39;} };</li>
        <li class="line-empty">-- 	}</li>
        <li class="line-empty">--</li>
        <li class="line-empty">-- 	local data = arrr {&#39;--foo&#39;, &#39;bar&#39;, &#39;--bar&#39;, &#39;hello&#39;, &#39;-abc&#39;, &#39;baz&#39;}</li>
        <li class="line-empty">local function parser(descriptors)</li>
        <li class="line-hit">	local register = setmetatable(parse(descriptors), __parser)</li>
        <li class="line-hit">	return register</li>
        <li class="line-empty">end</li>
        <li class="line-empty">
</li>
        <li class="line-hit">return parser</li>
    </ul>

  </section>

        </section>
      </main>

      <footer class="quiet">
        Code coverage generated by <a href="https://keplerproject.github.io/luacov/" target="_blank">LuaCov</a> at 2022-11-25 11:43:39
      </footer>
    </div>
  </body>
</html>
